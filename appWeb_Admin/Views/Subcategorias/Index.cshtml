@model IEnumerable<appWeb_Admin.Models.SubcategoriaModel>

@{
    ViewData["Title"] = "Listado de Subcategorías";
}

<div class="container mt-3">
    @* Alerta de Éxito *@
    @if (TempData["MensajeOk"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i> @TempData["MensajeOk"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @* Alerta de Error (Aquí es donde saldrá lo de la categoría padre inactiva) *@
    @if (TempData["MensajeError"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-octagon-fill me-2"></i> @TempData["MensajeError"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
</div>

<div class="container mt-4">
    <h2>Listado de Subcategorías de Eventos</h2>
    <hr />

    <form asp-action="Index" method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <label class="form-label">Nombre Subcategoría</label>
            <input type="text" name="nombre" class="form-control" value="@ViewBag.FiltroNombre" placeholder="Buscar por nombre..." />
        </div>

        <div class="col-md-3">
            <label class="form-label">Estado</label>
            <select name="estado" class="form-select">
                <option value="">-- Todos --</option>
                <option value="true" selected="@(ViewBag.FiltroEstado == true)">Activo</option>
                <option value="false" selected="@(ViewBag.FiltroEstado == false)">Inactivo</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Categoría</label>
            <select name="idCategoria" class="form-select">
                <option value="">-- Todas las Categorías --</option>
                @if (ViewBag.Categorias != null)
                {
                    foreach (var cat in ViewBag.Categorias)
                    {
                        <! -- Comparamos para dejar seleccionada la opción buscada -->
                        <option value="@cat.IdCategoriaEvento"
                                selected="@(ViewBag.FiltroCategoria == cat.IdCategoriaEvento)">
                            @cat.NombreCategoria
                        </option>
                    }
                }
            </select>
        </div>

        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-search"></i> Filtrar
            </button>
        </div>
    </form>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h4 class="fw-semibold mb-0">Categorías de eventos</h4>
            <small class="text-muted">Administración de categorías</small>
        </div>

        <a asp-action="Crear" class="btn btn-primary">
            + Crear sub-categoría
        </a>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Subcategoría</th>
                    <th>Categoría Padre</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.IdSubcategoriaEvento</td>
                            <td>@item.NombreSubcategoria</td>
                            <td>
                                <span class="badge bg-info text-dark">@item.NombreCategoria</span>
                            </td>
                            <td class="text-center">
                                <form asp-action="CambiarEstado"
                                      method="post"
                                      class="d-flex flex-column align-items-center gap-1">

                                    <input type="hidden" name="id" value="@item.IdSubcategoriaEvento" />

                                    <div class="form-check form-switch">
                                        <input class="form-check-input"
                                               type="checkbox"
                                               role="switch"
                                               name="estado"
                                               value="true"
                                               @(item.EstaActivo ? "checked" : "")
                                               onchange="this.form.submit()" />

                                        <input type="hidden" name="estado" value="false" />
                                    </div>

                                    <span class="small badge @(item.EstaActivo ? "bg-success" : "bg-secondary")">
                                        @(item.EstaActivo ? "Activo" : "Inactivo")
                                    </span>
                                </form>
                            </td>
                            <td>
                                <a asp-action="Editar" asp-route-id="@item.IdSubcategoriaEvento" class="btn btn-warning btn-sm">Editar</a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted">No se encontraron registros.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>